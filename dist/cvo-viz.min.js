!function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){!function(t,n){"object"==typeof e&&e.exports?e.exports=n():"function"==typeof define&&define.amd?define(n):t.Spinner=n()}(this,function(){"use strict";function t(t,e){var n,i=document.createElement(t||"div");for(n in e)i[n]=e[n];return i}function e(t){for(var e=1,n=arguments.length;n>e;e++)t.appendChild(arguments[e]);return t}function n(t,e,n,i){var o=["opacity",e,~~(100*t),n,i].join("-"),r=.01+n/i*100,s=Math.max(1-(1-t)/e*(100-r),t),a=u.substring(0,u.indexOf("Animation")).toLowerCase(),l=a&&"-"+a+"-"||"";return p[o]||(c.insertRule("@"+l+"keyframes "+o+"{0%{opacity:"+s+"}"+r+"%{opacity:"+t+"}"+(r+.01)+"%{opacity:1}"+(r+e)%100+"%{opacity:"+t+"}100%{opacity:"+s+"}}",c.cssRules.length),p[o]=1),o}function i(t,e){var n,i,o=t.style;if(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==o[e])return e;for(i=0;i<h.length;i++)if(n=h[i]+e,void 0!==o[n])return n}function o(t,e){for(var n in e)t.style[i(t,n)||n]=e[n];return t}function r(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)void 0===t[i]&&(t[i]=n[i])}return t}function s(t,e){return"string"==typeof t?t:t[e%t.length]}function a(t){this.opts=r(t||{},a.defaults,f)}function l(){function n(e,n){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}c.addRule(".spin-vml","behavior:url(#default#VML)"),a.prototype.lines=function(t,i){function r(){return o(n("group",{coordsize:c+" "+c,coordorigin:-u+" "+-u}),{width:c,height:c})}function a(t,a,l){e(p,e(o(r(),{rotation:360/i.lines*t+"deg",left:~~a}),e(o(n("roundrect",{arcsize:i.corners}),{width:u,height:i.scale*i.width,left:i.scale*i.radius,top:-i.scale*i.width>>1,filter:l}),n("fill",{color:s(i.color,t),opacity:i.opacity}),n("stroke",{opacity:0}))))}var l,u=i.scale*(i.length+i.width),c=2*i.scale*u,h=-(i.width+i.length)*i.scale*2+"px",p=o(r(),{position:"absolute",top:h,left:h});if(i.shadow)for(l=1;l<=i.lines;l++)a(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=i.lines;l++)a(l);return e(t,p)},a.prototype.opacity=function(t,e,n,i){var o=t.firstChild;i=i.shadow&&i.lines||0,o&&e+i<o.childNodes.length&&(o=o.childNodes[e+i],o=o&&o.firstChild,o=o&&o.firstChild,o&&(o.opacity=n))}}var u,c,h=["webkit","Moz","ms","O"],p={},f={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(a.defaults={},r(a.prototype,{spin:function(e){this.stop();var n=this,i=n.opts,r=n.el=t(null,{className:i.className});if(o(r,{position:i.position,width:0,zIndex:i.zIndex,left:i.left,top:i.top}),e&&e.insertBefore(r,e.firstChild||null),r.setAttribute("role","progressbar"),n.lines(r,n.opts),!u){var s,a=0,l=(i.lines-1)*(1-i.direction)/2,c=i.fps,h=c/i.speed,p=(1-i.opacity)/(h*i.trail/100),f=h/i.lines;!function d(){a++;for(var t=0;t<i.lines;t++)s=Math.max(1-(a+(i.lines-t)*f)%h*p,i.opacity),n.opacity(r,t*i.direction+l,s,i);n.timeout=n.el&&setTimeout(d,~~(1e3/c))}()}return n},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(i,r){function a(e,n){return o(t(),{position:"absolute",width:r.scale*(r.length+r.width)+"px",height:r.scale*r.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/r.lines*c+r.rotate)+"deg) translate("+r.scale*r.radius+"px,0)",borderRadius:(r.corners*r.scale*r.width>>1)+"px"})}for(var l,c=0,h=(r.lines-1)*(1-r.direction)/2;c<r.lines;c++)l=o(t(),{position:"absolute",top:1+~(r.scale*r.width/2)+"px",transform:r.hwaccel?"translate3d(0,0,0)":"",opacity:r.opacity,animation:u&&n(r.opacity,r.trail,h+c*r.direction,r.lines)+" "+1/r.speed+"s linear infinite"}),r.shadow&&e(l,o(a("#000","0 0 4px #000"),{top:"2px"})),e(i,e(l,a(s(r.color,c),"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(t,e,n){e<t.childNodes.length&&(t.childNodes[e].style.opacity=n)}}),"undefined"!=typeof document){c=function(){var n=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}();var d=o(t("group"),{behavior:"url(#default#VML)"});!i(d,"transform")&&d.adj?l():u=i(d,"animation")}return a})},{}],2:[function(t,e,n){"use strict";var i=t("../utils/format.js"),o=t("spin.js");e.exports=function(t,e){var n=this,r=e||{orientation:"vertical",spin:{color:"#888",lines:8}};this.selector=t,this._spinner=new o(r.spin),this.draw=function(t,e){"[object Array]"===Object.prototype.toString.call(e)?this._handleMultiQuery(t,e):this._handleSingleQuery(t,e)},this._handleMultiQuery=function(t,e){t.run(e,function(t,i){if(t)return void console.log(t);for(var o=0,r=[];o<e.length;o++)r.push(i[o].result);n._render(r)})},this._handleSingleQuery=function(t,e){t.run(e,function(t,e){return t?void console.log(t):void n._render(e.result)})},this._render=function(t){var e=0,o=t.length,s="vertical"===r.orientation?"width":"height";for(n._endLoading();o>e;e++){var a=e+1,l=t[e],u=$(n.selector).find(".funnel-step-"+a),c=a>=o,h=c?0:t[a],p=l-h,f=100*(p/l).toFixed(4),d=0>=f?0:(100-f).toFixed(0);u.find(".funnel-step-value").text(i.nFormat(l,1)),u.find(".funnel-step-bar").css(s,(l>0&&0>=d?100:d)+"%"),c||(u.find(".funnel-step-ratio").text((100-f).toFixed(2)+"%"),u.find(".funnel-step-churn-ratio").text(f.toFixed(2)+"%"))}},this._startLoading=function(){var t=$(n.selector),e=$('<div class="viz-loading"></div>');t.hide(),t.parent().append(e),n._spinner.spin(e[0])},this._endLoading=function(){var t=$(n.selector);n._spinner.stop(),t.parent().find(".viz-loading").remove(),t.show()},n._startLoading()}},{"../utils/format.js":8,"spin.js":1}],3:[function(t,e,n){"use strict";e.exports=function(e){var n=t("../utils/latch.js"),i=new n(0,this);this.holder={},this.onReady=e,this.afterDraw=function(){},this.register=function(t,e){this.holder[t]={rows:[],meta:e||{}}},this.waitFor=function(t){i.limit=t,console.log("Waiting for",t,"acks...")},this.ack=function(){i.countDown()},this.lacks=function(t){return void 0===this.holder[t]},this.has=function(t){return!this.lacks(t)},this.push=function(t,e){this.rows(t).push(e)},this.rows=function(t){return this.holder[t].rows},this.meta=function(t){return this.holder[t].meta},this.length=function(t){return this.rows(t).length},this.sum=function(t){var e=0;return $.each(this.rows(t),function(){e+=parseFloat(this)||0}),e}}},{"../utils/latch.js":9}],4:[function(t,e,n){"use strict";function i(t,e){this.opts=$.extend(!0,s.Pure,e),this.id=t;var n=this,i=this.opts;this.components=[new o.Title(i.title),new o.Value(i.value),new o.Delta(i.delat),new o.Sum(i.sum),new o.Bars(i.bars),new o.Sparkline(i.sparkline),new o.Bullet(i.bullet)],this.datum=new r(function(){n._render(),n._afterDraw()}),this._spinner=new a(i.spin),this._afterDraw=function(){},n._startLoading()}var o=t("./ui.js"),r=t("./datum.js"),s=t("../themes"),a=t("spin.js");i.version="0.0.1",i.prototype.draw=function(t,e){var n="[object Array]"===Object.prototype.toString.call(t)?t:[t],i=this;this._afterDraw=e||this._afterDraw,this.datum.waitFor(n.length),$.each(n,function(t,e){e.data?i._handleRawData(e):e.query.params.group_by?i._handleGroupQuery(e.client,e.query):i._handleQuery(e)})},i.prototype._startLoading=function(){var t=$('<div class="viz-loading"></div>'),e=$(this.id);e.hide(),e.parent().append(t),this._spinner.spin(t[0])},i.prototype._endLoading=function(){var t=$(this.id);this._spinner.stop(),t.parent().find(".viz-loading").remove(),t.show()},i.prototype._render=function(){var t=0,e=$(this.id),n=this._findTemplate(e),i=this.datum,o=e.attr("id")||this.id.substring(1);this._endLoading();for(var r in i.holder){var s={key:r,datum:i,rows:i.rows(r),meta:i.meta(r),length:i.length(r),sum:i.sum(r)},a=n.clone();a.removeAttr(this.opts.templateAttr),a.attr("id",o+"-"+t),e.append(a);for(var l=0;l<this.components.length;l++){var u=this.components[l];u.accepts(a)&&u.render(s)}t++}n.remove()},i.prototype._findTemplate=function(t){var e=this.opts.templateAttr,n=t.find("["+e+"]");if(n.length>0)return n;throw new Error("Template not found.Please, add a child element with a '"+e+"' attribute.")},i.prototype._handleRawData=function(t){var e=this.datum,n=t.name;e.register(n,t.meta),$.each(t.data,function(t,i){e.push(n,i.value)}),e.ack()},i.prototype._handleGroupQuery=function(t,e){if(e.params.group_by.constructor===Array)throw new Error("Multiple group by properties not yet supported.");var n=e.params.group_by,i=this.datum,o=function(t,e){return t?void console.log(t):($.each(e.result,function(){if(void 0===this.timeframe)throw new Error("The result is not a time serie. Please, specify timeframe and interval.");$.each(this.value,function(){i.lacks(this[n])&&i.register(this[n]),i.push(this[n],this.result)})}),void i.ack())};t.run(e,o)},i.prototype._handleQuery=function(t){var e=t.query,n=t.name,i=t.client,o=t.meta,r=this.datum;r.register(n,o),i.run(e,function(t,e){return t?void console.log(t):($.each(e.result,function(t,e){r.push(n,e.value)}),void r.ack())})},e.exports=i},{"../themes":6,"./datum.js":3,"./ui.js":5,"spin.js":1}],5:[function(t,e,n){"use strict";var i=t("../utils/format.js"),o=t("../utils/extend.js"),r={};r.Component=function(){},r.Component.prototype={el:null,selector:null,config:null,init:function(t,e){var n=$.extend(!0,e,t||{});this.selector=n.selector,this.config=n.config},accepts:function(t){var e=t.find(this.selector);return e.length>0?(this.el=e,!0):!1},text:function(t){this.el.text(t)},addClass:function(t){this.el.addClass(t)},sparkline:function(t,e){this.el.sparkline(t,e)}},r.Title=function(t){this.init(t,{selector:".kpi-title"}),this.render=function(t){this.text(t.key)}},o(r.Title,r.Component),r.Value=function(t){this.init(t,{selector:".kpi-last-value"}),this.render=function(t){var e=t.rows[t.length-1];"function"==typeof t.meta.valueFmt?this.text(t.meta.valueFmt(e,i.nFormat)):t.meta.ratios?this.text(i.nPercent(e)):this.text(i.nFormat(e))}},o(r.Value,r.Component),r.Sum=function(t){this.init(t,{selector:".kpi-sum"}),this.render=function(t){"function"==typeof t.meta.valueFmt?this.text(t.meta.valueFmt(t.sum,i.nFormat)):t.meta.ratios?this.text(i.nPercent(t.sum/t.length)):this.text(i.nFormat(t.sum))}},o(r.Sum,r.Component),r.Delta=function(t){this.init(t,{selector:".kpi-delta"}),this.render=function(t){if(t.rows.length<2)return void this.text("-");var e=t.rows,n=e[e.length-1],o=e[e.length-2],r=e.length<2?0:n-o,s="delta-"+(0>r?"neg":0===r?"none":"pos"),a=0===o?r/100:r/o;this.addClass(s),this.text(i.nPercent(a))}},o(r.Delta,r.Component),r.Sparkline=function(t){this.init(t,{selector:".kpi-sparkline"}),this.render=function(t){this.sparkline(t.rows,this.config.chart)}},o(r.Sparkline,r.Component),r.Bars=function(t){this.init(t,{selector:".kpi-bars",config:{chart:{type:"bar"}}}),this.render=function(t){this.sparkline(t.rows,this.config.chart)}},o(r.Bars,r.Component),r.Bullet=function(t){this.init(t,{selector:".kpi-bullet",config:{chart:{type:"bullet"}}}),this.render=function(t){var e=this.el.parent().find(this.selector+"-value"),n=$.extend({ranges:[200,100,50],targetPct:100,target:1e3},t.meta.bullet||{}),o=i.asPercentage(t.sum/n.target);o=0>o?0:o,this.sparkline([n.targetPct,o,n.ranges[0],n.ranges[1],n.ranges[2]],this.config.chart),e.length>0&&(e[0].innerHTML=o+' <span class="kpi-bullet-desc">['+i.nFormat(t.sum,1)+"/"+i.nFormat(n.target,1)+"]</span>")}},o(r.Bullet,r.Component),e.exports=r},{"../utils/extend.js":7,"../utils/format.js":8}],6:[function(t,e,n){"use strict";var i={extend:function(t){return $.extend(!0,this.Pure,t)}};i.Pure={templateAttr:"data-kpi-template",sparkline:{config:{chart:{width:"100%",lineColor:"#474843",spotColor:"#474843",minSpotColor:"#C21A01",maxSpotColor:"#519548",highlightSpotColor:"#474843",highlightLineColor:"#B4BCBC",spotRadius:2,fillColor:!1}}},bullet:{config:{chart:{width:"100%",targetColor:"#256295",performanceColor:"#474843",rangeColors:["#C5CFC6","#9D9D93","#7B7B71"]}}},bars:{config:{chart:{barColor:"#474843",barWidth:10,negBarColor:"#C21A01"}}},spin:{color:"#888",lines:8}},i.Bootstrap=i.extend({sparkline:{config:{chart:{lineColor:"#222",spotColor:"#337AB7",minSpotColor:"#D9534F",maxSpotColor:"#5CB85C",highlightSpotColor:"#555",highlightLineColor:"#B4BCBC"}}},bullet:{config:{chart:{targetColor:"#337AB7",performanceColor:"#222",rangeColors:["#EEE","#FCF8E3","#F2DEDE"]}}},spin:{color:"#888",lines:8}}),e.exports=i},{}],7:[function(t,e,n){"use strict";e.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],8:[function(t,e,n){"use strict";var i=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}];e.exports={asPercentage:function(t){return parseFloat((100*t.toFixed(4)).toFixed(2))},nPercent:function(t){return this.asPercentage(t)+"%"},nFormat:function(t,e){for(var n=0,o=e||1,r=i,s=Math.abs(t);n<r.length;n++)if(s>=r[n].value)return(t/r[n].value).toFixed(o).replace(/\.?0+$/,"")+r[n].symbol;return String(parseFloat(t.toFixed(o)))}}},{}],9:[function(t,e,n){"use strict";e.exports=function(t,e){var n=0;this.limit=t,this.countDown=function(){n++,this.limit<=n&&e.onReady(),console.log("Count",n,"of",this.limit)}}},{}],10:[function(t,e,n){(function(i){!function(t){"use strict";"function"==typeof define&&define.amd&&define("viz",[],t),"object"==typeof n&&"undefined"!=typeof e&&(e.exports=t());var o=null;"undefined"!=typeof window?o=window:"undefined"!=typeof i?o=i:"undefined"!=typeof self&&(o=self),o&&(o.Viz=t())}(function(){"use strict";var n={Theme:t("./themes"),Scorecard:t("./scorecard"),Funnel:t("./funnel")};return e.exports=n,n})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./funnel":2,"./scorecard":4,"./themes":6}]},{},[10]);
