!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";var r=t("../utils/format.js");e.exports=function(t,e){var n=this,e=e||{orientation:"vertical"};this.selector=t,this.draw=function(t,e){$.isArray(e)?this._handleMultiQuery(t,e):this._handleSingleQuery(t,e)},this._handleMultiQuery=function(t,e){t.run(e,function(t,r){if(t)return void console.log(t);for(var i=0,o=[];i<e.length;i++)o.push(r[i].result);n._render(o)})},this._handleSingleQuery=function(t,e){t.run(e,function(t,e){return t?void console.log(t):void n._render(e.result)})},this._render=function(t){for(var i=0,o=t.length,s="vertical"===e.orientation?"width":"height";o>i;i++){var a=i+1,l=t[i],u=$(n.selector).find(".funnel-step-"+a),c=a>=o,h=c?0:t[a],f=l-h,p=100*(f/l).toFixed(4),d=0>=p?0:(100-p).toFixed(0);u.find(".funnel-step-value").text(r.nFormat(l,1)),u.find(".funnel-step-bar").css(s,(l>0&&0>=d?100:d)+"%"),c||(u.find(".funnel-step-ratio").text((100-p).toFixed(2)+"%"),u.find(".funnel-step-churn-ratio").text(p.toFixed(2)+"%"))}}}},{"../utils/format.js":7}],2:[function(t,e,n){"use strict";e.exports=function(e){var n=t("../utils/latch.js"),r=new n(0,this);this.holder={},this.onReady=e,this.afterDraw=function(){},this.register=function(t,e){this.holder[t]={rows:[],meta:e||{}}},this.waitFor=function(t){r.limit=t,console.log("Waiting for",t,"acks...")},this.ack=function(){r.countDown()},this.lacks=function(t){return void 0===this.holder[t]},this.has=function(t){return!this.lacks(t)},this.push=function(t,e){this.rows(t).push(e)},this.rows=function(t){return this.holder[t].rows},this.meta=function(t){return this.holder[t].meta},this.length=function(t){return this.rows(t).length},this.sum=function(t){var e=0;return $.each(this.rows(t),function(){e+=parseFloat(this)||0}),e}}},{"../utils/latch.js":8}],3:[function(t,e,n){"use strict";function r(t,e){this.opts=$.extend(!0,s.Pure,e),this.id=t;var n=this,r=this.opts;this.components=[new i.Title(r.title),new i.Value(r.value),new i.Delta(r.delat),new i.Sum(r.sum),new i.Bars(r.bars),new i.Sparkline(r.sparkline),new i.Bullet(r.bullet)],this.datum=new o(function(){n._render(),n._afterDraw()}),this._afterDraw=function(){}}var i=t("./ui.js"),o=t("./datum.js"),s=t("../themes");r.version="0.0.1",r.prototype.draw=function(t,e){var n="[object Array]"===Object.prototype.toString.call(t)?t:[t],r=this;this._afterDraw=e||this._afterDraw,this.datum.waitFor(n.length),$.each(n,function(t,e){e.data?r._handleRawData(e):e.query.params.group_by?r._handleGroupQuery(e.client,e.query):r._handleQuery(e)})},r.prototype._render=function(){var t=0,e=$(this.id),n=this._findTemplate(e),r=this.datum,i=e.attr("id")||this.id.substring(1);for(var o in r.holder){var s={key:o,datum:r,rows:r.rows(o),meta:r.meta(o),length:r.length(o),sum:r.sum(o)},a=n.clone();a.removeAttr(this.opts.templateAttr),a.attr("id",i+"-"+t),e.append(a);for(var l=0;l<this.components.length;l++){var u=this.components[l];u.accepts(a)&&u.render(s)}t++}n.remove()},r.prototype._findTemplate=function(t){var e=this.opts.templateAttr,n=t.find("["+e+"]");if(n.length>0)return n;throw new Error("Template not found.Please, add a child element with a '"+e+"' attribute.")},r.prototype._handleRawData=function(t){var e=this.datum,n=t.name;e.register(n,t.meta),$.each(t.data,function(t,r){e.push(n,r.value)}),e.ack()},r.prototype._handleGroupQuery=function(t,e){if(e.params.group_by.constructor===Array)throw new Error("Multiple group by properties not yet supported.");var n=e.params.group_by,r=this.datum,i=function(t,e){return t?void console.log(t):($.each(e.result,function(){if(void 0===this.timeframe)throw new Error("The result is not a time serie. Please, specify timeframe and interval.");$.each(this.value,function(){r.lacks(this[n])&&r.register(this[n]),r.push(this[n],this.result)})}),void r.ack())};t.run(e,i)},r.prototype._handleQuery=function(t){var e=t.query,n=t.name,r=t.client,i=t.meta,o=this.datum;o.register(n,i),r.run(e,function(t,e){return t?void console.log(t):($.each(e.result,function(t,e){o.push(n,e.value)}),void o.ack())})},e.exports=r},{"../themes":5,"./datum.js":2,"./ui.js":4}],4:[function(t,e,n){"use strict";var r=t("../utils/format.js"),i=t("../utils/extend.js"),o={};o.Component=function(){},o.Component.prototype={el:null,selector:null,config:null,init:function(t,e){var n=$.extend(!0,e,t||{});this.selector=n.selector,this.config=n.config},accepts:function(t){var e=t.find(this.selector);return e.length>0?(this.el=e,!0):!1},text:function(t){this.el.text(t)},addClass:function(t){this.el.addClass(t)},sparkline:function(t,e){this.el.sparkline(t,e)}},o.Title=function(t){this.init(t,{selector:".kpi-title"}),this.render=function(t){this.text(t.key)}},i(o.Title,o.Component),o.Value=function(t){this.init(t,{selector:".kpi-last-value"}),this.render=function(t){var e=t.rows[t.length-1];"function"==typeof t.meta.valueFmt?this.text(t.meta.valueFmt(e,r.nFormat)):t.meta.ratios?this.text(r.asPercentage(e)+"%"):this.text(r.nFormat(e))}},i(o.Value,o.Component),o.Sum=function(t){this.init(t,{selector:".kpi-sum"}),this.render=function(t){"function"==typeof t.meta.valueFmt?this.text(t.meta.valueFmt(t.sum,r.nFormat)):t.meta.ratios?this.text(r.asPercentage(t.sum/t.length)+"%"):this.text(r.nFormat(t.sum))}},i(o.Sum,o.Component),o.Delta=function(t){this.init(t,{selector:".kpi-delta"}),this.render=function(t){if(t.rows.length<2)return void this.text("-");var e=t.rows,n=e[e.length-1],i=e[e.length-2],o=e.length<2?0:n-i,s="delta-"+(0>o?"neg":0===o?"none":"pos"),a=0===i?o/100:o/i;this.addClass(s),this.text(r.asPercentage(a)+"%")}},i(o.Delta,o.Component),o.Sparkline=function(t){this.init(t,{selector:".kpi-sparkline"}),this.render=function(t){this.sparkline(t.rows,this.config.chart)}},i(o.Sparkline,o.Component),o.Bars=function(t){this.init(t,{selector:".kpi-bars",config:{chart:{type:"bar"}}}),this.render=function(t){this.sparkline(t.rows,this.config.chart)}},i(o.Bars,o.Component),o.Bullet=function(t){this.init(t,{selector:".kpi-bullet",config:{chart:{type:"bullet"}}}),this.render=function(t){var e=this.el.parent().find(this.selector+"-value"),n=$.extend({ranges:[200,100,50],targetPct:100,target:1e3},t.meta.bullet||{}),i=r.asPercentage(t.sum/n.target);i=0>i?0:i,this.sparkline([n.targetPct,i,n.ranges[0],n.ranges[1],n.ranges[2]],this.config.chart),e.length>0&&(e[0].innerHTML=i+' <span class="kpi-bullet-desc">['+r.nFormat(t.sum,1)+"/"+r.nFormat(n.target,1)+"]</span>")}},i(o.Bullet,o.Component),e.exports=o},{"../utils/extend.js":6,"../utils/format.js":7}],5:[function(t,e,n){"use strict";var r={extend:function(t){return $.extend(!0,this.Pure,t)}};r.Pure={templateAttr:"data-kpi-template",sparkline:{config:{chart:{width:"100%",lineColor:"#474843",spotColor:"#474843",minSpotColor:"#C21A01",maxSpotColor:"#519548",highlightSpotColor:"#474843",highlightLineColor:"#B4BCBC",spotRadius:2,fillColor:!1}}},bullet:{config:{chart:{width:"100%",targetColor:"#256295",performanceColor:"#474843",rangeColors:["#C5CFC6","#9D9D93","#7B7B71"]}}},bars:{config:{chart:{barColor:"#474843",barWidth:10,negBarColor:"#C21A01"}}}},r.Bootstrap=r.extend({sparkline:{config:{chart:{lineColor:"#222",spotColor:"#337AB7",minSpotColor:"#D9534F",maxSpotColor:"#5CB85C",highlightSpotColor:"#555",highlightLineColor:"#B4BCBC"}}},bullet:{config:{chart:{targetColor:"#337AB7",performanceColor:"#222",rangeColors:["#EEE","#FCF8E3","#F2DEDE"]}}}}),e.exports=r},{}],6:[function(t,e,n){"use strict";e.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],7:[function(t,e,n){"use strict";var r=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}];e.exports={asPercentage:function(t){return parseFloat((100*t.toFixed(4)).toFixed(2))},nFormat:function(t,e){for(var n=0,i=e||1,o=r,s=Math.abs(t);n<o.length;n++)if(s>=o[n].value)return(t/o[n].value).toFixed(i).replace(/\.?0+$/,"")+o[n].symbol;return String(parseFloat(t.toFixed(i)))}}},{}],8:[function(t,e,n){"use strict";e.exports=function(t,e){var n=0;this.limit=t,this.countDown=function(){n++,this.limit<=n&&e.onReady(),console.log("Count",n,"of",this.limit)}}},{}],9:[function(t,e,n){(function(r){!function(t){"use strict";"function"==typeof define&&define.amd&&define("viz",[],t),"object"==typeof n&&"undefined"!=typeof e&&(e.exports=t());var i=null;"undefined"!=typeof window?i=window:"undefined"!=typeof r?i=r:"undefined"!=typeof self&&(i=self),i&&(i.Viz=t())}(function(){"use strict";var n={Theme:t("./themes"),Scorecard:t("./scorecard"),Funnel:t("./funnel")};return e.exports=n,n})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./funnel":1,"./scorecard":3,"./themes":5}]},{},[9]);
