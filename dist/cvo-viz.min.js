!function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";var r=t("../utils/format.js");e.exports=function(t){var e=this;this.selector=t,this.draw=function(t,n){t.run(n,function(t,n){return t?void console.log(t):void e._render(n.result)})},this._render=function(t){var n=t[0],o=0;$.each(t,function(t,i){var s=t+1,a=$(e.selector).find(".funnel-step-"+s),l=0>=n?0:100-((n-i)/n*100).toFixed(0),u=o-i;a.find(".funnel-step-value").text(r.nFormat(i,1)),a.find(".funnel-step-bar").css("width",(i>0&&0>=l?1:l)+"%"),u>=0&&a.find(".funnel-step-ratio").text((100-100*(u/o).toFixed(4)).toFixed(2)+"%"),o=i})}}},{"../utils/format.js":7}],2:[function(t,e,n){"use strict";e.exports=function(e){var n=t("../utils/latch.js"),r=new n(0,this);this.holder={},this.onReady=e,this.afterDraw=function(){},this.register=function(t,e){this.holder[t]={rows:[],meta:e||{}}},this.waitFor=function(t){r.limit=t,console.log("Waiting for",t,"acks...")},this.ack=function(){r.countDown()},this.lacks=function(t){return void 0===this.holder[t]},this.has=function(t){return!this.lacks(t)},this.push=function(t,e){this.rows(t).push(e)},this.rows=function(t){return this.holder[t].rows},this.meta=function(t){return this.holder[t].meta},this.length=function(t){return this.rows(t).length},this.sum=function(t){var e=0;return $.each(this.rows(t),function(){e+=parseFloat(this)||0}),e}}},{"../utils/latch.js":8}],3:[function(t,e,n){"use strict";function r(t,e){this.opts=$.extend(!0,s.Pure,e),this.id=t;var n=this,r=this.opts;this.components=[new o.Title(r.title),new o.Value(r.value),new o.Delta(r.delat),new o.Sum(r.sum),new o.Bars(r.bars),new o.Sparkline(r.sparkline),new o.Bullet(r.bullet)],this.datum=new i(function(){n._render(),n._afterDraw()}),this._afterDraw=function(){}}var o=t("./ui.js"),i=t("./datum.js"),s=t("../themes");r.version="0.0.1",r.prototype.draw=function(t,e){var n="[object Array]"===Object.prototype.toString.call(t)?t:[t],r=this;this._afterDraw=e||this._afterDraw,this.datum.waitFor(n.length),$.each(n,function(t,e){e.query.params.group_by?r._handleGroupQuery(e.client,e.query):r._handleQuery(e)})},r.prototype._render=function(){var t=0,e=$(this.id),n=this._findTemplate(e),r=this.datum,o=e.attr("id")||this.id.substring(1);for(var i in r.holder){var s={key:i,datum:r,rows:r.rows(i),meta:r.meta(i),length:r.length(i),sum:r.sum(i)},a=n.clone();a.removeAttr(this.opts.templateAttr),a.attr("id",o+"-"+t),e.append(a);for(var l=0;l<this.components.length;l++){var u=this.components[l];u.accepts(a)&&u.render(s)}t++}n.remove()},r.prototype._findTemplate=function(t){var e=this.opts.templateAttr,n=t.find("["+e+"]");if(n.length>0)return n;throw new Error("Template not found.Please, add a child element with a '"+e+"' attribute.")},r.prototype._handleGroupQuery=function(t,e){if(e.params.group_by.constructor===Array)throw new Error("Multiple group by properties not yet supported.");var n=e.params.group_by,r=this.datum,o=function(t,e){return t?void console.log(t):($.each(e.result,function(){if(void 0===this.timeframe)throw new Error("The result is not a time serie. Please, specify timeframe and interval.");$.each(this.value,function(){r.lacks(this[n])&&r.register(this[n]),r.push(this[n],this.result)})}),void r.ack())};t.run(e,o)},r.prototype._handleQuery=function(t){var e=t.query,n=t.name,r=t.client,o=t.meta,i=this.datum;i.register(n,o),r.run(e,function(t,e){return t?void console.log(t):($.each(e.result,function(t,e){i.push(n,e.value)}),void i.ack())})},e.exports=r},{"../themes":5,"./datum.js":2,"./ui.js":4}],4:[function(t,e,n){"use strict";var r=t("../utils/format.js"),o=t("../utils/extend.js"),i={};i.Component=function(){},i.Component.prototype={el:null,selector:null,config:null,init:function(t,e){var n=$.extend(!0,e,t||{});this.selector=n.selector,this.config=n.config},accepts:function(t){var e=t.find(this.selector);return e.length>0?(this.el=e,!0):!1},text:function(t){this.el.text(t)},addClass:function(t){this.el.addClass(t)},sparkline:function(t,e){this.el.sparkline(t,e)}},i.Title=function(t){this.init(t,{selector:".kpi-title"}),this.render=function(t){this.text(t.key)}},o(i.Title,i.Component),i.Value=function(t){this.init(t,{selector:".kpi-last-value"}),this.render=function(t){this.text(r.nFormat(t.rows[t.length-1]))}},o(i.Value,i.Component),i.Sum=function(t){this.init(t,{selector:".kpi-sum"}),this.render=function(t){this.text(r.nFormat(t.sum))}},o(i.Sum,i.Component),i.Delta=function(t){this.init(t,{selector:".kpi-delta"}),this.render=function(t){if(t.rows.length<2)return void this.text("-");var e=t.rows,n=e[e.length-1],o=e[e.length-2],i=e.length<2?0:n-o,s="delta-"+(0>i?"neg":0===i?"none":"pos"),a=i>=0?0===o?i:i/o:0===n?i:i/n;this.addClass(s),this.text(r.asPercentage(a)+"%")}},o(i.Delta,i.Component),i.Sparkline=function(t){this.init(t,{selector:".kpi-sparkline"}),this.render=function(t){this.sparkline(t.rows,this.config.chart)}},o(i.Sparkline,i.Component),i.Bars=function(t){this.init(t,{selector:".kpi-bars",config:{chart:{type:"bar"}}}),this.render=function(t){this.sparkline(t.rows,this.config.chart)}},o(i.Bars,i.Component),i.Bullet=function(t){this.init(t,{selector:".kpi-bullet",config:{chart:{type:"bullet"}}}),this.render=function(t){var e=this.el.parent().find(this.selector+"-value"),n=$.extend({ranges:[200,100,50],targetPct:100,target:1e3},t.meta.bullet||{}),o=r.asPercentage(t.sum/n.target);o=0>o?0:o,this.sparkline([n.targetPct,o,n.ranges[0],n.ranges[1],n.ranges[2]],this.config.chart),e.length>0&&(e[0].innerHTML=o+' <span class="kpi-bullet-desc">['+r.nFormat(t.sum,1)+"/"+r.nFormat(n.target,1)+"]</span>")}},o(i.Bullet,i.Component),e.exports=i},{"../utils/extend.js":6,"../utils/format.js":7}],5:[function(t,e,n){"use strict";var r={extend:function(t){return $.extend(!0,this.Pure,t)}};r.Pure={templateAttr:"data-kpi-template",sparkline:{config:{chart:{width:"100%",lineColor:"#474843",spotColor:"#474843",minSpotColor:"#C21A01",maxSpotColor:"#519548",highlightSpotColor:"#474843",highlightLineColor:"#B4BCBC",spotRadius:2,fillColor:!1}}},bullet:{config:{chart:{width:"100%",targetColor:"#256295",performanceColor:"#474843",rangeColors:["#C5CFC6","#9D9D93","#7B7B71"]}}},bars:{config:{chart:{barColor:"#474843",barWidth:10,negBarColor:"#C21A01"}}}},r.Bootstrap=r.extend({sparkline:{config:{chart:{lineColor:"#222",spotColor:"#337AB7",minSpotColor:"#D9534F",maxSpotColor:"#5CB85C",highlightSpotColor:"#555",highlightLineColor:"#B4BCBC"}}},bullet:{config:{chart:{targetColor:"#337AB7",performanceColor:"#222",rangeColors:["#EEE","#FCF8E3","#F2DEDE"]}}}}),e.exports=r},{}],6:[function(t,e,n){"use strict";e.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],7:[function(t,e,n){"use strict";var r=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}];e.exports={asPercentage:function(t){return parseFloat((100*t.toFixed(4)).toFixed(2))},nFormat:function(t,e){for(var n=0,o=e||1,i=r,s=Math.abs(t);n<i.length;n++)if(s>=i[n].value)return(t/i[n].value).toFixed(o).replace(/\.?0+$/,"")+i[n].symbol;return t}}},{}],8:[function(t,e,n){"use strict";e.exports=function(t,e){var n=0;this.limit=t,this.countDown=function(){n++,this.limit<=n&&e.onReady(),console.log("Count",n,"of",this.limit)}}},{}],9:[function(t,e,n){(function(r){!function(t){"use strict";"function"==typeof define&&define.amd&&define("viz",[],t),"object"==typeof n&&"undefined"!=typeof e&&(e.exports=t());var o=null;"undefined"!=typeof window?o=window:"undefined"!=typeof r?o=r:"undefined"!=typeof self&&(o=self),o&&(o.Viz=t())}(function(){"use strict";var n={Theme:t("./themes"),Scorecard:t("./scorecard"),Funnel:t("./funnel")};return e.exports=n,n})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./funnel":1,"./scorecard":3,"./themes":5}]},{},[9]);
